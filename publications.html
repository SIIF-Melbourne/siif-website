<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Publications</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="scripts/header.js" defer></script>
    <script src="scripts/footer.js" defer></script>
</head>
<body>
    <section class="publications-intro">
        <header></header>
        <h1>Publications Archive</h1>
    </section>

    <main>
        <div class="publication-tabs">
            <button class="publication-tab active" data-content="interest-articles">Articles</button>
            <button class="publication-tab" data-content="macro-updates">Macro Market Update Archive</button>
            <button class="publication-tab" data-content="insta-feed">Instagram Feed</button>
        </div>
        
        <!-- Interest Articles Content -->
        <div id="interest-articles" class="publication-content active">
            <section class="articles-section">
                <h2>Featured Articles</h2>
                <div class="article-cards">
                    <!-- <div class="article-card">
                        <div class="article-image">
                            <img src="https://lshtgdpdskhqqxdcwpjo.supabase.co/storage/v1/object/public/photos//StockPhoto.jpg" alt="Interest rates chart">
                            <span class="article-category">Interest Piece</span>
                        </div>
                        <div class="article-content">
                            <h3 class="article-title">Guide</h3>
                            <span class="article-date">Example for publications team</span>
                            <a href="publications/guide.html" class="read-more">Read Article</a>
                        </div>
                    </div> -->
                    <!-- <div class="article-card">
                        <div class="article-image">
                            <img src="https://lshtgdpdskhqqxdcwpjo.supabase.co/storage/v1/object/public/photos//StockPhoto.jpg" alt="Interest rates chart">
                            <span class="article-category">Interest Piece</span>
                        </div>
                        <div class="article-content">
                            <h3 class="article-title">LOREM IPSUM</h3>
                            <span class="article-date">May 1, 2025</span>
                            <a href="publications/example.html" class="read-more">Read Article</a>
                        </div>
                    </div> -->
                    <div class="article-card">
                        <div class="article-image">
                            <img src="https://lshtgdpdskhqqxdcwpjo.supabase.co/storage/v1/object/public/photos/publications/StockPhoto2.jpg" alt="Enterprise vs Equity Value">
                            <span class="article-category">Educational Piece</span>
                        </div>
                        <div class="article-content">
                            <h3 class="article-title">Enterprise Value vs. Equity Value: Interview Guide</h3>
                            <span class="article-date">May 24, 2025</span>
                            <a href="publications/24May2025.html" class="read-more">Read Article</a>
                        </div>
                    </div>
                    <div class="article-card">
                        <div class="article-image">
                            <img src="https://lshtgdpdskhqqxdcwpjo.supabase.co/storage/v1/object/public/photos/publications/StockPhoto.jpg" alt="DCF Model Diagram">
                            <span class="article-category">Educational Piece</span>
                        </div>
                        <div class="article-content">
                            <h3 class="article-title">DCF Analysis: Interview Guide</h3>
                            <span class="article-date">May 11, 2025</span>
                            <a href="publications/11May2025.html" class="read-more">Read Article</a>
                        </div>
                    </div>
                </div>
            </section>
        </div>
        
        <!-- Macro Updates Content -->
        <div id="macro-updates" class="publication-content">
            <section class="publications-section">
                <div class="disclaimer">
                    <strong>Disclaimer:</strong> All decisions and research has been done by students. The following decisions are made with the financial objects of the fund in mind, including education. They are not financial advice.
                </div>
                
                <p class="macro-description">A data-driven insight into market trends, key developments, and indicators to watch in the week ahead.</p>
                
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Link</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- <tr>
                            <td>Macro Market Update Template</td>
                            <td>Month 00, 2025</td>
                            <td><a href="pdfs/Market Update Template.pdf" target="_blank">View PDF</a></td>
                        </tr> -->
                        <tr>
                            <td>May 5, 2025</td>
                            <td><a href="https://www.instagram.com/p/DJQJOpfTQEU/?utm_source=ig_web_button_share_sheet&igsh=MzRlODBiNWFlZA==" target="_blank">View Instagram Post</a></td>
                        </tr>
                        <tr>
                            <td>April 28, 2025</td>
                            <td><a href="https://www.instagram.com/p/DI-OmyLT6sR/?utm_source=ig_web_button_share_sheet&igsh=MzRlODBiNWFlZA==" target="_blank">View Instagram Post</a></td>
                        </tr>
                        <tr>
                            <td>April 7, 2025</td>
                            <td><a href="https://www.instagram.com/p/DIIQjRATEiX/?utm_source=ig_web_button_share_sheet&igsh=MzRlODBiNWFlZA==" target="_blank">View Instagram Post</a></td>
                        </tr>
                        <tr>
                            <td>March 31, 2025</td>
                            <td><a href="https://www.instagram.com/p/DH2fz0qT3hB/?utm_source=ig_web_button_share_sheet&igsh=MzRlODBiNWFlZA==" target="_blank">View Instagram Post</a></td>
                        </tr>
                        <tr>
                            <td>March 24, 2025</td>
                            <td><a href="https://www.instagram.com/p/DHkwIrNTd5a/?utm_source=ig_web_copy_link&igsh=MzRlODBiNWFlZA==" target="_blank">View Instagram Post</a></td>
                        </tr>
                    </tbody>
                </table>
            </section>
        </div>

        <div id="insta-feed" class="publication-content">
            <div class="feed" id="feed">

                <!-- Post 1 -->
                <div class="post">
                  <div class="post-header">user123</div>
                  <div class="carousel-container">
                    <button class="arrow left" onclick="scrollCarousel(this, -1)">‚ùÆ</button>
                    <div class="carousel">
                      <img src="http://127.0.0.1:5000/image?blob_name=DPk12u4k1g9-01" alt="Image 1" draggable="false"/>
                      <img src="http://127.0.0.1:5000/image?blob_name=DPk12u4k1g9-02" alt="Image 2" draggable="false"/>
                    </div>
                    <button class="arrow right" onclick="scrollCarousel(this, 1)">‚ùØ</button>
                  </div>
                  <div class="post-caption">Loving the view! üèûÔ∏è</div>
                </div>
              
                <!-- Post 2 -->
                <div class="post">
                  <div class="post-header">naturelover</div>
                  <div class="carousel-container">
                    <button class="arrow left" onclick="scrollCarousel(this, -1)">‚ùÆ</button>
                    <div class="carousel">
                      <img src="http://127.0.0.1:5000/image?blob_name=DPsMsRJE6sJ-01" alt="Image 1" draggable="false"/>
                      <img src="http://127.0.0.1:5000/image?blob_name=DPsMsRJE6sJ-02" alt="Image 2" draggable="false"/>
                      <img src="http://127.0.0.1:5000/image?blob_name=DPsMsRJE6sJ-03" alt="Image 3" draggable="false"/>
                    </div>
                    <button class="arrow right" onclick="scrollCarousel(this, 1)">‚ùØ</button>
                  </div>
                  <div class="post-caption">Adventure continues üåÑ</div>
                </div>
              
              </div>
        </div>
    </main>

    <footer></footer>
    
    <script>
async function fetchAndRenderPosts() {
  try {
    const response = await fetch('http://127.0.0.1:5000/image?blob_name=_metadata');
    const posts = await response.json();
    const feed = document.getElementById('feed');
    feed.innerHTML = '';
    posts.forEach(post => {
      const postDiv = document.createElement('div');
      postDiv.classList.add('post');

      // --- New: Title and Date Header Bar ---
      const headerBar = document.createElement('div');
      headerBar.classList.add('post-header-bar');
      const titleDiv = document.createElement('div');
      titleDiv.classList.add('post-title');
      titleDiv.textContent = post.title || "Untitled Post";
      const timeDiv = document.createElement('div');
      timeDiv.classList.add('post-time');
      if (post.date) {
        const dateObj = new Date(post.date);
        timeDiv.textContent = dateObj.toLocaleString(undefined, {
          year: 'numeric',
          month: 'short',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit',
        });
      } else {
        timeDiv.textContent = '';
      }
      headerBar.appendChild(titleDiv);
      headerBar.appendChild(timeDiv);
      postDiv.appendChild(headerBar);

      // Post username header
      const headerDiv = document.createElement('div');
      headerDiv.classList.add('post-header');
      headerDiv.textContent = post.username;
      postDiv.appendChild(headerDiv);

      const carouselContainer = document.createElement('div');
      carouselContainer.classList.add('carousel-container');

      // Left arrow
      const leftBtn = document.createElement('button');
      leftBtn.classList.add('arrow', 'left');
      leftBtn.innerHTML = '‚ùÆ';
      leftBtn.onclick = () => scrollCarousel(leftBtn, -1);
      carouselContainer.appendChild(leftBtn);

      // Carousel div
      const carouselDiv = document.createElement('div');
      carouselDiv.classList.add('carousel');

      // Dots container
      const dotsContainer = document.createElement('div');
      dotsContainer.classList.add('carousel-dots');

      for (let i = 1; i <= post.count; i++) {
        const img = document.createElement('img');
        img.src = `http://127.0.0.1:5000/image?blob_name=${post.id}-${i.toString().padStart(2, '0')}`;
        img.alt = `Image ${i}`;
        img.draggable = false;
        carouselDiv.appendChild(img);

        const dot = document.createElement('span');
        dot.classList.add('dot');
        dot.dataset.index = i - 1;
        dotsContainer.appendChild(dot);
      }
      carouselContainer.appendChild(carouselDiv);

      // Right arrow
      const rightBtn = document.createElement('button');
      rightBtn.classList.add('arrow', 'right');
      rightBtn.innerHTML = '‚ùØ';
      rightBtn.onclick = () => scrollCarousel(rightBtn, 1);
      carouselContainer.appendChild(rightBtn);

      if (post.count > 1) {
        carouselContainer.appendChild(dotsContainer);
      }

      postDiv.appendChild(carouselContainer);

      // Description
      if (post.description) {
        const descriptionDiv = document.createElement('div');
        descriptionDiv.classList.add('post-description');
        descriptionDiv.textContent = post.description;
        postDiv.appendChild(descriptionDiv);
      }

      feed.appendChild(postDiv);
    });
    initCarousels();
  } catch (error) {
    console.error('Failed to fetch posts:', error);
  }
}

function initCarousels() {
  document.querySelectorAll('.carousel').forEach(carousel => {
    let isDragging = false;
    let startX;
    let scrollStart;
    let lastX;
    let lastTime;
    let velocity = 0;

    const leftArrow = carousel.parentElement.querySelector('.arrow.left');
    const rightArrow = carousel.parentElement.querySelector('.arrow.right');
    const dots = carousel.parentElement.querySelectorAll('.dot');

    function updateCarouselUI() {
      const scrollLeft = carousel.scrollLeft;
      const imageWidth = carousel.clientWidth || 1;
      const currentIndex = Math.round(scrollLeft / imageWidth);

      dots.forEach((dot, index) => {
        dot.classList.toggle('active', index === currentIndex);
      });

      if (dots.length <= 1) {
        leftArrow.style.display = 'none';
        rightArrow.style.display = 'none';
      } else {
        leftArrow.style.display = currentIndex === 0 ? 'none' : 'block';
        rightArrow.style.display = currentIndex === dots.length - 1 ? 'none' : 'block';
      }
    }
    updateCarouselUI();

    dots.forEach(dot => {
      dot.addEventListener('click', () => {
        const imageWidth = carousel.clientWidth;
        const index = parseInt(dot.dataset.index, 10);
        carousel.scrollTo({ left: imageWidth * index, behavior: 'smooth' });
      });
    });

    carousel.addEventListener('mousedown', (e) => {
      isDragging = true;
      carousel.classList.add('dragging');
      carousel.style.scrollSnapType = 'none';
      carousel.style.scrollBehavior = 'auto';
      startX = e.clientX;
      scrollStart = carousel.scrollLeft;
      lastX = e.clientX;
      lastTime = Date.now();
      velocity = 0;
      e.preventDefault();
    });

    document.addEventListener('mouseup', () => {
      if (!isDragging) return;
      isDragging = false;
      carousel.classList.remove('dragging');
      carousel.style.scrollSnapType = 'x mandatory';
      carousel.style.scrollBehavior = 'smooth';

      const imageWidth = carousel.clientWidth;
      const currentIndex = Math.round(scrollStart / imageWidth);

      // Calculate momentum scroll distance
      let momentumDistance = velocity * 200;
      // Clamp momentum distance to one image width
      momentumDistance = Math.max(-imageWidth, Math.min(momentumDistance, imageWidth));

      let tentativeScroll = carousel.scrollLeft - momentumDistance;
      let targetIndex = Math.round(tentativeScroll / imageWidth);

      // Clamp target index to within one slide move
      if (targetIndex > currentIndex + 1) targetIndex = currentIndex + 1;
      if (targetIndex < currentIndex - 1) targetIndex = currentIndex - 1;

      const maxIndex = Math.floor((carousel.scrollWidth - carousel.clientWidth) / imageWidth);
      targetIndex = Math.max(0, Math.min(targetIndex, maxIndex));

      carousel.scrollTo({ left: targetIndex * imageWidth, behavior: 'smooth' });
      updateCarouselUI();
    });

    document.addEventListener('mousemove', (e) => {
      if (!isDragging) return;

      const now = Date.now();
      const dx = e.clientX - lastX;
      const dt = now - lastTime;
      velocity = dt > 0 ? dx / dt : 0;
      lastX = e.clientX;
      lastTime = now;

      const deltaX = e.clientX - startX;
      const maxScroll = carousel.scrollWidth - carousel.clientWidth;
      const imageWidth = carousel.clientWidth;

      let desiredScroll = scrollStart - deltaX;

      // Clamp desiredScroll to prevent over-scrolling beyond one image at either edge
      const minScroll = Math.max(0, scrollStart - imageWidth);
      const maxAllowedScroll = Math.min(maxScroll, scrollStart + imageWidth);

      if (desiredScroll < minScroll) desiredScroll = minScroll;
      if (desiredScroll > maxAllowedScroll) desiredScroll = maxAllowedScroll;

      carousel.scrollLeft = desiredScroll;
    });

    carousel.addEventListener('scroll', () => {
      requestAnimationFrame(updateCarouselUI);
    });

    // Prevent default dragstart behavior on images to avoid glitches
    carousel.querySelectorAll('img').forEach(img => {
      img.setAttribute('draggable', 'false');
      img.addEventListener('dragstart', e => e.preventDefault());
      // **Fix for last image glitch: stop propagation of click events on last image**
      // We'll stop the click event on the last image so it doesn't trigger unwanted carousel scroll
      // Identify last image in the carousel
      const images = Array.from(carousel.querySelectorAll('img'));
      const lastImage = images[images.length - 1];
      if (img === lastImage) {
        img.addEventListener('click', e => {
          // Prevent click event bubbling that triggers carousel scroll back
          e.stopPropagation();
        });
      }
    });
  });
}

function scrollCarousel(button, direction) {
  const carousel = button.parentElement.querySelector('.carousel');
  const imageWidth = carousel.clientWidth;
  carousel.scrollBy({ left: imageWidth * direction, behavior: 'smooth' });
}

document.addEventListener('DOMContentLoaded', () => {
  const tabs = document.querySelectorAll('.publication-tab');
  const contentContainers = document.querySelectorAll('.publication-content');

  tabs.forEach(tab => {
    tab.addEventListener('click', function () {
      tabs.forEach(t => t.classList.remove('active'));
      this.classList.add('active');
      contentContainers.forEach(container => container.classList.remove('active'));
      const contentId = this.getAttribute('data-content');
      document.getElementById(contentId).classList.add('active');
    });
  });

  fetchAndRenderPosts();
});
</script>

    
    
    

    <style>
      .feed {
        max-width: 600px;
        margin: auto;
        font-family: Arial, sans-serif;
      }

      .post {
        border: 1px solid #ccc;
        padding: 10px;
        margin-bottom: 20px;
      }

      .post-header {
        font-weight: bold;
        margin-bottom: 10px;
      }

      .carousel-container {
        position: relative;
      }

      .carousel {
        display: flex;
        overflow-x: auto;
        scroll-snap-type: x mandatory;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none; /* Firefox */
        scroll-behavior: smooth; /* enables smooth scroll for buttons & snap */
        cursor: grab;
        cursor: -webkit-grab;
      }

      .carousel.dragging {
        cursor: grabbing;
        cursor: -webkit-grabbing;
      }

      .carousel::-webkit-scrollbar {
        display: none; /* Chrome, Safari */
      }

      .carousel img {
        flex-shrink: 0;
        width: 100%;
        scroll-snap-align: start;
        object-fit: cover;
        pointer-events: none; /* prevents drag interference */
        user-select: none;
        -webkit-user-drag: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
      }

      .arrow {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(0, 0, 0, 0.5);
        color: white;
        border: none;
        padding: 10px;
        cursor: pointer;
        z-index: 1;
      }

      .arrow.left {
        left: 5px;
      }

      .arrow.right {
        right: 5px;
      }

      .post-caption {
        margin-top: 10px;
      }

      .carousel-dots {
        text-align: center;
        margin-top: 10px;
      }

      .carousel-dots .dot {
        display: inline-block;
        width: 10px;
        height: 10px;
        margin: 0 4px;
        background-color: #aaa; /* more visible than #ccc */
        border-radius: 50%;
        transition: background-color 0.3s, transform 0.3s;
        opacity: 0.7;
      }

      .carousel-dots .dot.active {
        background-color: #333;
        opacity: 1;
        transform: scale(1.2);
      }

      .post-description {
        white-space: pre-wrap;
      }

      .post-header-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 6px;
        font-weight: bold;
        font-size: 1.1em;
      }

      .post-time {
        color: #666;
        font-size: 0.9em;
        white-space: nowrap;
      }

    </style>
</body>
</html>